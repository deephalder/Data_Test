---
output:
  html_document: default
  pdf_document: default
  word_document: default
---
title: "Titanic Analysis"
author: "Subhradip Halder"
date: Sys.date
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
#Introduction

This analysis attempts to predicate the probability for survival of the Titanic passengers. In order to do this, I will use the different features available about the passengers, use a subset of the data to train an algorithm and then run the algorithm on the rest of the data set to get a prediction.

In this analysis I have done the following :

1. Optimized the imported data set and handled the missing values
2. Performed an analysis on the relationship between the features and a passenger’s chance of survival.

#Aquisation of Data
this is being handled in the function file - data_aquisition.R
#' Function to Acquire the data for analysis
#' This function imports the train file for titanic data analysis and stores them in a dataframe.
#' @export

```{r echo=TRUE, message=FALSE, warning=FALSE}
data_aquisition <- function(){

path <-system.file(package = "DataTest","files","train.csv")
train<- read.csv(path) # reading the data from the path.
LT=dim(train)[1] # variable to count the number of total passengers.
usethis::use_data(train, overwrite = TRUE) #saving train to an rda file.
train
}

```

#Optimisation

This part is handled in the function file - data_optimisition.R
```{r echo=TRUE, message=FALSE, warning=FALSE}
#' Function to optimise the data.
#' This function handles the missing data, and formates the data for analysis
#' @export
titanic_optimisation <- function(){

        # Checking for NA data.
        colSums(is.na(train))

        #checking for the missing data
        colSums(train == "")

        # as for this dataset we have a lot of missing values for the Age feature
        # we will be using the locf(last observation carried forward) function from Zoo package
        # to fill the NA values.

        train <- zoo::na.locf(train)

        # Let's change the empty values  in Embarked to the first choice "C"
        train$Embarked[train$Embarked==""]="C"

        # to find out the total number of unique values for each  features.
        apply(train, 2, function(x) length(unique(x)))

        #moving features Survived, Pclass, Sex, Embarked to be factors
        cols <- c("Survived","Pclass","Sex","Embarked")
        for (i in cols){
                train[,i] <- as.factor(train[,i])
        }
        
        titanic_optimisation()

        #updating the train.rda file with optimised data.
        usethis::use_data(train, overwrite = TRUE)
}
```
# Analysis

At this time point I loaded and cleaned a little bit of the data. Now it’s time to look at the relationships between the different features:

#Loading necessary packages:
```{r echo=TRUE, message=FALSE, warning=FALSE}
# I used the following packages for this analysis:

library(ggplot2)
library(dplyr)
library(GGally)
library(rpart)
library(rpart.plot)

# First, let's look at the relationship between sex and survival:
ggplot(data=train[1:LT,],aes(x=Sex,fill=Survived))+geom_bar()

# Survival as a function of Embarked:
ggplot(data = train[1:LT,],aes(x=Embarked,fill=Survived))+geom_bar(position="fill")+ylab("Frequency")

t<-table(train[1:LT,]$Embarked,train[1:LT,]$Survived)
for (i in 1:dim(t)[1]){
    t[i,]<-t[i,]/sum(t[i,])*100
}
t
#It looks that you have a better chance to survive if you Embarked in 'C' (55% compared to 33% and 38%).

# Survival as a function of Pclass:
ggplot(data = train[1:LT,],aes(x=Pclass,fill=Survived))+geom_bar(position="fill")+ylab("Frequency")
# It looks like you have a better chance to survive if you in lower ticket class.
# Now, let's devide the graph of Embarked by Pclass:
ggplot(data = train[1:LT,],aes(x=Embarked,fill=Survived))+geom_bar(position="fill")+facet_wrap(~Pclass)

# Now it's not so clear that there is a correlation between Embarked and Survival. 

# Survivial as a function of SibSp and Parch
ggplot(data = train[1:LT,],aes(x=SibSp,fill=Survived))+geom_bar()
ggplot(data = train[1:LT,],aes(x=Parch,fill=Survived))+geom_bar()

# The dymanics of SibSp and Parch are very close one each other.
# Let's try to look at another parameter: family size.

train$FamilySize <- train$SibSp + train$Parch +1;
train1<-train[1:LT,]
ggplot(data = train1[!is.na(train[1:LT,]$FamilySize),],aes(x=FamilySize,fill=Survived))+geom_histogram(binwidth =1,position="fill")+ylab("Frequency")

# That shows that families with a family size bigger or equal to 2 but less than 6 have a more than 50% to survive, in contrast to families with 1 member or more than 5 members. 

```
